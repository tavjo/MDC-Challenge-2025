FROM python:3.11-slim

# Install only required dependencies
RUN pip install uv

# Set working directory
WORKDIR /app

# Install only the specific dependencies needed for the API service
# Using uv pip install instead of uv add for Docker builds (no project context needed)
RUN uv pip install --system fastapi uvicorn duckdb chromadb sentence-transformers \
    llama-index llama-index-core llama-index-embeddings-openai openai \
    python-dotenv tiktoken pandas pytest pydantic pyyaml typing-extensions

# Copy necessary files
COPY src/ /app/src/
COPY api/ /app/api/
COPY configs/ /app/configs/

# Create necessary directories
RUN mkdir -p artifacts logs

# Set environment variables
ENV PYTHONPATH=/app

# Run the API service
CMD ["uvicorn", "api.main:app", "--host", "0.0.0.0", "--port", "8000"] 